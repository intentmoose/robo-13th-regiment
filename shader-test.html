<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Synthwave Sun with Mountains in Shader</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  </head>
  <body>
    <a-scene>
      <!-- Entity for the sun -->
      <a-entity geometry="primitive: plane; width: 6; height: 6"
                material="shader: synthwave-sun-mountains-shader"
                position="0 2.5 -7">
      </a-entity>

      <!-- Camera -->
      <a-camera position="0 1.6 0"></a-camera>

      <!-- Vertex Shader -->
      <script id="vertex-shader" type="x-shader/x-vertex">
        varying vec2 vUV;
        void main() {
          vUV = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
      </script>

      <!-- Fragment Shader -->
      <script id="fragment-shader" type="x-shader/x-fragment">
        precision mediump float;
        uniform float time;
        varying vec2 vUV;

        // Function to draw triangular mountains
        float mountain(vec2 uv, float peakX, float peakY, float width) {
          float slope = abs(uv.x - peakX) / width;
          return uv.y - (peakY - slope);
        }

        void main() {
          vec2 uv = vUV;
          vec2 sunCenter = vec2(0.5, 0.5);
          float sunRadius = 0.45;

          // Gradient colors for the sun
          vec3 topColor = vec3(1.0, 0.8, 0.0); // Yellow-orange
          vec3 bottomColor = vec3(1.0, 0.2, 0.3); // Pink-red

          // Calculate distance from the center of the sun
          float dist = length(uv - sunCenter);
          vec3 color = mix(bottomColor, topColor, smoothstep(0.0, 1.0, uv.y));

          // Create very thick and slow-moving lines on the lower half
          if (dist < sunRadius && uv.y < 0.5) {
            float lineThickness = 0.2;
            float speed = time * 0.0001;  // Very slow animation
            float lines = mod(uv.y * 2.0 + speed, 0.3);
            color = mix(color, vec3(0.0), step(lineThickness, lines));
          }

          // Add mountains by using a few triangular shapes
          float m1 = mountain(uv, 0.3, 0.35, 0.1); // Mountain 1
          float m2 = mountain(uv, 0.5, 0.3, 0.15); // Mountain 2 (bigger)
          float m3 = mountain(uv, 0.7, 0.4, 0.12); // Mountain 3
          
          // Combine the mountains into a silhouette
          if (m1 < 0.0 || m2 < 0.0 || m3 < 0.0) {
            color = vec3(0.0); // Make mountains black
          }

          // Final output: render the sun or mountains
          if (dist < sunRadius || (m1 < 0.0 || m2 < 0.0 || m3 < 0.0)) {
            gl_FragColor = vec4(color, 1.0); // Inside the sun or mountains, output color
          } else {
            discard; // Outside the sun and mountains, make transparent
          }
        }
      </script>

      <!-- Register Shader -->
      <script>
        AFRAME.registerShader('synthwave-sun-mountains-shader', {
          schema: { time: { type: 'time', is: 'uniform' } },
          vertexShader: document.getElementById('vertex-shader').textContent,
          fragmentShader: document.getElementById('fragment-shader').textContent
        });
      </script>
    </a-scene>
  </body>
</html>
